---
layout: post
title: Windows Subsystem for Linux Internals
date: '2019-02-28T21:09:00.002Z'
author: Andy Aspell-Clark
tags:
- software
- computers
modified_time: '2019-03-01T07:17:15.503Z'
thumbnail: https://3.bp.blogspot.com/-BKu9RxhuFjU/XDj7DsE-z4I/AAAAAAADFqw/qqoOPvykLx0YRfpj2beYWWhLMgOlDMiPwCK4BGAYYCw/s72-c/word1-example-1.png
blogger_id: tag:blogger.com,1999:blog-8558253627828403034.post-3937550000945481024
blogger_orig_url: https://aspellclark.blogspot.com/2019/02/windows-subsystem-for-linux-internals.html
---

<h3>Background</h3><div>Windows Subsystem for Linux was developed by Microsoft to enable command line programs compiled for the Linux operating system to be executed on Windows.</div><div><br /></div><div>To explain the architecture I would like to show the evolution of OS design and how that has enabled this subsystem to be built.</div><div><br /></div><h3>Dark Ages (or Back in the Day)</h3><div>Microsoft's MS-DOS was quite primitive in its design (compared to today's OS's). It is a single user OS that can execute one process at a time. DOS had an application programming interface to allow user programs to access some hardware in a device independent way, but only for character-based applications.</div><div><br /></div><div>This allowed applications to display graphical elements emulated with text characters as these screenshots of Microsoft word for DOS show:</div><div><br /></div><div><a href="http://3.bp.blogspot.com/-BKu9RxhuFjU/XDj7DsE-z4I/AAAAAAADFqw/qqoOPvykLx0YRfpj2beYWWhLMgOlDMiPwCK4BGAYYCw/s1600/word1-example-1.png" imageanchor="1"><img border="0" height="400" src="https://3.bp.blogspot.com/-BKu9RxhuFjU/XDj7DsE-z4I/AAAAAAADFqw/qqoOPvykLx0YRfpj2beYWWhLMgOlDMiPwCK4BGAYYCw/s640/word1-example-1.png" width="640" /></a></div><div><br /></div><div>This is Microsoft Word version 1.</div><div><br /></div><div><a href="http://2.bp.blogspot.com/-8hLXuT9wl00/XDj7Bs7dRMI/AAAAAAADFqo/62m2S4jt9DATQK0zrN4sPbeG54EJPDbVwCK4BGAYYCw/s1600/word1-example-2.png" imageanchor="1"><img border="0" height="400" src="https://2.bp.blogspot.com/-8hLXuT9wl00/XDj7Bs7dRMI/AAAAAAADFqo/62m2S4jt9DATQK0zrN4sPbeG54EJPDbVwCK4BGAYYCw/s640/word1-example-2.png" width="640" /></a></div><div><br /></div><div>To use these programs you had to remember key combinations to bring up the menus and used the cursor keys to navigate around the screen.</div><div><br /></div><div>If the application required fancy graphics, sounds or networking (or just wanted to allow the use of a mouse), then the application had to talk directly to that hardware using device-specific drivers.</div><div><br /></div><div><a href="http://3.bp.blogspot.com/-tj-574BazqI/XDj7OdBv7NI/AAAAAAADFq4/XR_HMeIeC5scYkkZDXNaR-B54thAKRiiQCK4BGAYYCw/s1600/MS-DOS_App_Architecture.png" imageanchor="1"><img border="0" height="374" src="https://3.bp.blogspot.com/-tj-574BazqI/XDj7OdBv7NI/AAAAAAADFq4/XR_HMeIeC5scYkkZDXNaR-B54thAKRiiQCK4BGAYYCw/s640/MS-DOS_App_Architecture.png" width="640" /></a></div><div><br /></div><div><br /></div><div>If you changed your sound/network/video card, applications might stop working as they might not have drivers for it.</div><div><br /></div><h3>Windows</h3><div>On 20th November 1985 Microsoft launched <a href="https://en.wikipedia.org/wiki/Windows_1.0" target="_blank">Windows version 1.0</a>.</div><div><br /></div><div>The first version of Windows ran on top of MS-DOS and presented a Graphical User Interface.</div><div><br /></div><div><a href="http://4.bp.blogspot.com/-Fo39mAr1rjo/XDj7UgDLL7I/AAAAAAADFrA/8JHOG342qogLtixB6M8RIPNupew2w3w0wCK4BGAYYCw/s1600/windows1.png" imageanchor="1"><img border="0" height="478" src="https://4.bp.blogspot.com/-Fo39mAr1rjo/XDj7UgDLL7I/AAAAAAADFrA/8JHOG342qogLtixB6M8RIPNupew2w3w0wCK4BGAYYCw/s640/windows1.png" width="640" /></a></div><div><br /></div><div>Windows 1 introduced the hardware abstraction layer into the PC application architecture. Windows 1 included drivers for video cards, a mouse, keyboards, printers and serial communications, and applications were supposed to only invoke The Windows APIs and not talk to the drivers directly.</div><div><br /></div><div>The windows OS has evolved a great deal over the years and the original windows 1 architecture was still in use as the foundation of Windows ME release in 2000.</div><div><br /></div><div>Starting in 1993 Microsoft created a purely 32 bit OS with no legacy code from Windows 1 architecture. The kernel created for Windows NT is still used as the base for current versions of Windows&nbsp;(although it has evolved since 1993).</div><div><br /></div><div>This is the basic structure of windows today. User applications talk to a layer in the kernel that abstracts out all details of the hardware and presents a unified API to user applications.</div><div><br /></div><div><a href="http://3.bp.blogspot.com/-2o4KPeV8iOk/XDj7n80RS1I/AAAAAAADFrQ/7kG0XFUCA0wW8mzj1IZ7IoI7XhwnuJgxACK4BGAYYCw/s1600/Windows_Architecture.png" imageanchor="1"><img border="0" height="640" src="https://3.bp.blogspot.com/-2o4KPeV8iOk/XDj7n80RS1I/AAAAAAADFrQ/7kG0XFUCA0wW8mzj1IZ7IoI7XhwnuJgxACK4BGAYYCw/s640/Windows_Architecture.png" width="574" /></a></div><div><br /></div><h3>## Linux</h3><div>In 1991, Linus Torvalds, a student at Helsinki university&nbsp;wanted an OS where he could play with its source code and learn about&nbsp;its internals. He started using an OS called Minix written by professor Andrew Tanenbaum and documented in a book which was aimed at students learning operating systems design. While the source code for the Minix system was available, modification and redistribution were restricted.</div><div><br /></div><div>This led Linus Torvalds to start writing his own OS which he called Linux.</div><div><br /></div><div>The first message about Linux was actually posted to the comp.os.minix newsgroup on <a href="https://groups.google.com/forum/#!msg/comp.os.minix/dlNtH7RRrGA/SwRavCzVE7gJ" target="_blank">25 Aug 1991 - First msg about Linux</a></div><div><br /></div><div>Linux has a similar architecture to current Windows versions. no user application accesses hardware devices directly not even by talking to device drivers. User applications talk to a layer in the kernel that abstracts out all details of the hardware and presents a unified API to user applications.</div><div><br /></div><div><a href="http://3.bp.blogspot.com/-OnG1aNwfxX8/XDj7yrC6GgI/AAAAAAADFrY/CvEszyezdYAR8PBnyv6iQiWSdxA8OgiIACK4BGAYYCw/s1600/Linux_Architecture.png" imageanchor="1"><img border="0" height="320" src="https://3.bp.blogspot.com/-OnG1aNwfxX8/XDj7yrC6GgI/AAAAAAADFrY/CvEszyezdYAR8PBnyv6iQiWSdxA8OgiIACK4BGAYYCw/s320/Linux_Architecture.png" width="292" /></a></div><div><br /></div><h3>Windows Subsystem for Linux</h3><div>So, finally on to the subject of this post.</div><div><br /></div><div>Microsoft hasn't always been a fan of Linux. Some people have even accused Microsoft of underhand tactics in the past designed to stop Linux being installed on PC's that also had Windows installed.</div><div><br /></div><div>But eventually, they have realised that developers seem to like the open source OS and have started supporting it.</div><div><br /></div><div>Windows Subsystem for Linux-August 2, 2016 (<a href="https://en.wikipedia.org/wiki/Windows_10#Redstone_1" target="_blank">Windows 10 Build 1607</a>)&nbsp;</div><div><br /></div><div>the Windows subsystem for Linux was written to allow text mode Linux programs to be executed on windows.</div><div><br /></div><div>"WSL executes unmodified Linux ELF64 binaries by virtualizing a Linux kernel interface on top of the Windows NT kernel"</div><div><br /></div><div>Basically, it performs real-time translation of Linux syscalls into Windows OS syscalls.</div><div><br /></div><div><a href="http://3.bp.blogspot.com/-BuBv2wzhSDo/XDj8G1oZ_DI/AAAAAAADFrk/eGwx7E25peo94k5cQjmXz1EjzXb8SegnACK4BGAYYCw/s1600/Windows-Subsystem-for-Linux-Architecture.png" imageanchor="1"><img border="0" height="640" src="https://3.bp.blogspot.com/-BuBv2wzhSDo/XDj8G1oZ_DI/AAAAAAADFrk/eGwx7E25peo94k5cQjmXz1EjzXb8SegnACK4BGAYYCw/s640/Windows-Subsystem-for-Linux-Architecture.png" width="520" /></a></div><div><br /></div><div><br /></div><div><br />So what it boils down to is that Microsoft wrote a Linux kernel 'emulator', which allows programs that call into the Linux kernel user-space API to execute on windows and not know it. But being only the Linux kernel, there are no graphics calls. Sorry but Xeyes won't run. Unix has a unique take on windowing systems. but that is a large subject and probably best left for another post. This one is long enough for now.</div><div><br /></div><h3>References</h3><div><ul><li><a href="http://www.catb.org/~esr/halloween/" target="_blank">The Halloween Documents-1 Nov 1998</a></li></ul></div><div><br /></div><div><br /></div>